## 9 ä¼ è¾¾äº‹ä»¶

åœ¨æœ¬è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨ç»„ä»¶ä¸­é€šä¿¡äº‹ä»¶çš„æ¦‚å¿µã€‚

------

### 9.1 ç›®æ ‡

ä½¿æˆ‘ä»¬çš„ç»„ä»¶èƒ½å¤Ÿè®©å…¶çˆ¶çº§ç»„ä»¶çŸ¥é“å…¶ä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚

------

### 9.2 å‘å‡ºäº‹ä»¶

æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾ä¸­é‡æ„å†…å®¹ï¼Œå°†ä¸äº§å“ç›¸å…³çš„ä»£ç ç§»åŠ¨åˆ°æ–°ç»„ä»¶`product-display`ä¸­æ—¶ï¼Œæˆ‘ä»¬ä¸­æ–­äº†å•å‡»"æ·»åŠ åˆ°è´­ç‰©è½¦"æŒ‰é’®å¹¶é€’å¢å€¼çš„èƒ½åŠ›ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨`product-display`ç»„ä»¶é‡Œåˆ é™¤äº†`cart`ï¼Œä»£æ›¿çš„æ·»åŠ åˆ°**main.js**é‡Œ

æˆ‘ä»¬éœ€è¦ä¸º`product-display`ç»„ä»¶æä¾›ä¸€ç§å®£å¸ƒå…¶æŒ‰é’®å·²å•å‡»çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡ï¼Ÿ

æˆ‘ä»¬å·²ç»çŸ¥propsæ˜¯å°†æ•°æ®ä¼ é€’åˆ°ç»„ä»¶ä¸­çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯å½“è¯¥ç»„ä»¶ä¸­å‘ç”ŸæŸäº›äº‹æƒ…ï¼ˆä¾‹å¦‚æŒ‰é’®å•å‡»ï¼‰æ—¶å‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•è®©å…¶ä»–éƒ¨åˆ†çŸ¥é“è¯¥äº‹ä»¶å‘ç”Ÿï¼Ÿ

![image-20220121174247022](./assets/images/image-20220121174247022.png)

ç­”æ¡ˆæ˜¯å‘å‡ºè¯¥äº‹ä»¶ï¼Œå‘Šè¯‰çˆ¶çº§ç»„ä»¶å®ƒå‘ç”Ÿäº†ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¿®æ”¹æ–¹æ³•åœ¨`product-display`ç»„ä»¶ä¸­æ·»åŠ `addToCart()`åŠŸèƒ½ã€‚

ğŸ“„**components/ProductDisplay.js**

```javascript
methods: {
	addToCart() {
		this.$emit('add-to-cart')
	}
	...
 }
```

æˆ‘ä»¬å°†ç¼–å†™`this.$emit()`å¹¶å‘å‡ºä¸€ä¸ªåä¸º`add-to-cart` çš„äº‹ä»¶ã€‚å› æ­¤ï¼Œå½“å•å‡»è¯¥æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘å‡ºæˆ–å†’æ³¡è¯¥äº‹ä»¶ã€‚å°±å¯ä»¥é€šè¿‡æ·»åŠ ä¾¦å¬å™¨ä»çˆ¶ä½œç”¨åŸŸï¼ˆæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨`product-display`ï¼‰ä¸­ä¾¦å¬è¯¥äº‹ä»¶ï¼š`@add-to-cart`

ğŸ“„**index.html**

```html
<product-display :premium="premium" @add-to-cart="updateCart"></product-display>
```

å½“è¯¥äº‹ä»¶è¢«çˆ¶çº§ç»„ä»¶"å¬åˆ°"æ—¶ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ªåä¸º`updateCart`çš„æ–°æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨**main.js**ä¸­æ·»åŠ è¯¥æ–¹æ³•ã€‚

![image-20220121175430022](./assets/images/image-20220121175430022.png)

ğŸ“„**main.js**

```javascript
const app = Vue.createApp({
    data() {
        return {
            cart: 0,
            premium: false
        }
    },
    methods: {
        updateCart() {
            this.cart += 1
        }
    }
})
```

æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œèƒ½å¤Ÿå•å‡»"æ·»åŠ åˆ°è´­ç‰©è½¦"æŒ‰é’®ï¼Œè¯¥æŒ‰é’®è®©çˆ¶çº§çŸ¥é“`add-to-cart`äº‹ä»¶å‘ç”Ÿï¼Œä»è€Œè§¦å‘`updateCart()`æ–¹æ³•ã€‚

![image-20220121182238069](./assets/images/image-20220121182238069.png)

------

### 9.3 å°†å•†å“IDæ·»åŠ åˆ°è´­ç‰©è½¦

ä¸ºäº†ä½¿æˆ‘ä»¬çš„ç¨‹åºæ›´åŠ é€¼çœŸï¼Œæˆ‘ä»¬çš„è´­ç‰©è½¦ä¸åº”è¯¥åªæ˜¯ä¸€ä¸ªæ•°å­—ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ·»åŠ åˆ°å…¶ä¸­çš„å•†å“çš„IDã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åšä¸€äº›é‡æ„ã€‚

ğŸ“„**main.js**

```javascript
const app = Vue.createApp({
	data() {
		return {
		cart: [],
		...
		}
	},
	methods: {
		updateCart(id) {
			this.cart.push(id)
		}
	}
})
```

ç°åœ¨ï¼Œ`cart`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ`updateCart(id)`å¹¶å°†å•†å“`id`æ”¾å…¥å…¶ä¸­ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨`add-to-cart`äº‹ä»¶å‘å°„ä¸­æ·»åŠ ï¼Œ`updateCart`å¯ä»¥è®¿é—®æ­¤`id`ã€‚

ğŸ“„**components/ProductDisplay.js**

```javascript
methods: {
	addToCart() {
		this.$emit('add-to-cart', this.items[this.selectedItem].id)
      }
    ...
 }
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ç¬¬äºŒä¸ªå‚æ•°å¹¶æŠ“å–äº†å•†å“çš„`id`å‚æ•°ï¼Œå°±åƒæˆ‘ä»¬æŠ“å–äº†ä¹‹å‰çš„`image`å’Œ`quantity`ä¸€æ ·ï¼š

ğŸ“„**components/ProductDisplay.js**

```javascript
computed: {
	image() {
		return this.items[this.selectedItem].image
	},
	inSlanket() {
		return this.items[this.selectedItem].quantity
	}
}
```

ç°åœ¨åœ¨æµè§ˆå™¨ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°†å•†å“IDæ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ï¼Œè¯¥è´­ç‰©è½¦ç°åœ¨æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

![image-20220121183343320](./assets/images/image-20220121183343320.png)

ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å®é™…æ˜¾ç¤ºè¿™äº›IDã€‚æˆ‘ä»¬åªæƒ³æ˜¾ç¤ºè´­ç‰©è½¦ä¸­æœ‰å¤šå°‘å•†å“ã€‚è¿˜å¥½è¿™éå¸¸å®¹æ˜“ä¿®æ”¹ã€‚æˆ‘ä»¬åªéœ€è¦å–æ•°ç»„çš„é•¿åº¦å³å¯ã€‚

ğŸ“„**index.html**

```html
<div id="app">
	...
	<div class="cart">è´­ç‰©è½¦({{ cart.length }})</div>
	...
 </div>
```

é€šè¿‡æ·»åŠ `cart.length`ï¼Œæˆ‘ä»¬ç°åœ¨å°†ä»…æ˜¾ç¤º `cart`ã€‚

------

### 9.4 ä»è´­ç‰©è½¦ä¸­åˆ é™¤

æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ–°çš„åˆ é™¤å•†å“çš„`button`ï¼ŒæŠŠå•†å“ä»è´­ç‰©è½¦ä¸­ç§»é™¤ã€‚æˆ‘ä»¬åœ¨`ProductDisplay.js`ç»„ä»¶ä¸­æ·»åŠ æ–°çš„`button`å’Œæ–°çš„æ–¹æ³•`removeFromCart`ï¼Œæ­¥éª¤å’Œæ·»åŠ åˆ°åˆ°è´­ç‰©è½¦`button`è¿‡ç¨‹ç±»ä¼¼ã€‚æˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡å•†å“IDæ¥åˆ é™¤å®ƒã€‚

ğŸ“„**components/ProductDisplay.js**

```javascript
app.component('product-display', {
    props: {
        premium: {
        type: Boolean,
        required: true
        }
    },
    template: 
        `<div class="display">
            <div class="container">
                ...
                <div class="info">
                    ...
                    <button 
                        class="button" 
                        :class="{ disabledButton: !inSlanket }" 
                        :disabled="!inSlanket" 
                        @click="addToCart">
                        æ·»åŠ åˆ°è´­ç‰©è½¦
                    </button>
                    <button 
                        class="button" 
                        :class="{ disabledButton: !inSlanket }" 
                        :disabled="!inSlanket" 
                        @click="removeFromCart">
                        åˆ é™¤å•†å“
                    </button>
                </div>
            </div>
        </div>`,
    ...
    methods: {
        updateItem(index) {
            this.selectedItem = index
        },
        addToCart() {
            this.$emit('add-to-cart', this.items[this.selectedItem].id)
        },
        removeFromCart() {
            this.$emit('remove-from-cart', this.items[this.selectedItem].id)
        }
    }
})
```

æ¥ç€åœ¨`index.html`çš„`product-display`ç»„ä»¶ä¸­æ·»åŠ `remove-from-cart`å‚æ•°

ğŸ“„**index.html**

```html
<body>
    <div id="app">
        <div class="nav-bar"></div>
        <div class="cart">è´­ç‰©è½¦({{ cart.length }})</div>
        <product-display 
            :premium="premium" 
            @add-to-cart="updateCart"
            @remove-from-cart="removeById">
        </product-display>
    </div>
    ...
</body>
```

æœ€ååœ¨`main.js`ä¸­æ·»åŠ `removeById`æ–¹æ³•

ğŸ“„**main.js**

```javascript
const app = Vue.createApp({
    data() {
        return {
            cart: [],
            premium: false
        }
    },
    methods: {
        updateCart(id) {
            this.cart.push(id)
        },
        removeById(id) {
            const index = this.cart.indexOf(id)
            if (index > -1) {
            	this.cart.splice(index, 1)
            }
        }
    }
})
```

ç½‘é¡µæ˜¾ç¤º

![image-20220121185959123](./assets/images/image-20220121185959123.png)

![image-20220121190010504](./assets/images/image-20220121190010504.png)



å®Œæ•´ä»£ç ï¼š

ğŸ“„**components/ProductDisplay.js**

```javascript
app.component('product-display', {
    props: {
        premium: {
        type: Boolean,
        required: true
        }
    },
    template: 
        `<div class="display">
            <div class="container">
                <div class="image">
                    <!-- å›¾ç‰‡æ”¾åœ¨è¿™-->
                    <img :src="image">
                </div>
                <div class="info">
                    <h1>{{ title }}</h1>
                    <p v-if="inSlanket > 10">æœ‰è´§</p>
                    <p v-else-if="inSlanket <= 10 && inSlanket > 0">å¿«è¦å–å…‰äº†</p>
                    <p v-else>ç¼ºè´§</p>
                    <ul>
                        <li v-for="detail in details">{{ detail }}</li>
                    </ul>
                    <div 
                        v-for="(item, index) in items" 
                        :key="item.id" 
                        @mouseover="updateItem(index)"
                        class="color-circle"
                        :style="{ backgroundColor: item.attrs }">
                    </div>
                    <p>è¿è´¹: {{ shipping }}</p>
                    <button 
                        class="button" 
                        :class="{ disabledButton: !inSlanket }" 
                        :disabled="!inSlanket" 
                        @click="addToCart">
                        æ·»åŠ åˆ°è´­ç‰©è½¦
                    </button>
                    <button 
                        class="button" 
                        :class="{ disabledButton: !inSlanket }" 
                        :disabled="!inSlanket" 
                        @click="removeFromCart">
                        åˆ é™¤å•†å“
                    </button>
                </div>
            </div>
        </div>`,
    data() {
        return {
            imginfo: 'åŠ åšæ¯›æ¯¯',
            brand: 'DDTalk',
            details: ['ç¾Šç¾”ç»’', 'åŠ åš', 'ä¿æš–'],
            items: [
                    { id: 001, attrs: '#1a65c0', image: './assets/images/blue.png', quantity: 50 },
                    { id: 002, attrs: '#ecb563', image: './assets/images/yellow.png', quantity: 0 }
            ],
            selectedItem: 0,
        }
    },
    computed: {
        title() {
            return this.brand + 'ç‰Œ' + this.imginfo
        },
        image() {
            return this.items[this.selectedItem].image
        },
        inSlanket() {
            return this.items[this.selectedItem].quantity
        },
        shipping() {
            if (this.premium) {
                return 'å…è´¹'
            }
            return 9.9
        },
    },
    methods: {
        addToCart() {
            this.cart += 1
        },
        updateItem(index) {
            this.selectedItem = index
        },
        addToCart() {
            this.$emit('add-to-cart', this.items[this.selectedItem].id)
        },
        removeFromCart() {
            this.$emit('remove-from-cart', this.items[this.selectedItem].id)
        }
    }
})
```

ğŸ“„**main.js**

```javascript
const app = Vue.createApp({
    data() {
        return {
            cart: [],
            premium: false
        }
    },
    methods: {
        updateCart(id) {
            this.cart.push(id)
        },
        removeById(id) {
            const index = this.cart.indexOf(id)
            if (index > -1) {
            	this.cart.splice(index, 1)
            }
        }
    }
})
```

ğŸ“„**index.html**

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>ä¼ è¾¾äº‹ä»¶</title>
    <!-- å¯¼å…¥å¼æ · -->
    <link rel="stylesheet" href="./assets/styles.css" />
    <!-- å¯¼å…¥ Vue.js -->
    <script src="https://unpkg.com/vue@next"></script>
</head>

<body>
    <div id="app">
        <div class="nav-bar"></div>
        <div class="cart">è´­ç‰©è½¦({{ cart.length }})</div>
        <product-display 
            :premium="premium" 
            @add-to-cart="updateCart"
            @remove-from-cart="removeById">
        </product-display>
    </div>
    <!-- å¯¼å…¥ç¼–å†™çš„javascript -->
    <script src="./main.js"></script>
    <!-- å¯¼å…¥Components -->
    <script src="./components/ProductDisplay.js"></script>
    <!-- æŒ‚è½½App -->
    <script>
        const mountedApp = app.mount('#app')
    </script>
</body>
</html>
```

